# AlmaLinux Kickstart (minimal headless VM) - Version 1
# Automated installation for nested virtualization lab

# Installation method and interface
text
install
cdrom

# Regional settings
lang en_US.UTF-8
keyboard us
timezone UTC

# Network configuration
network --bootproto=dhcp --device=eth0 --onboot=yes --activate

# Authentication and security
rootpw --plaintext alma123!
auth --useshadow --passalgo=sha512
firewall --enabled --ssh
selinux --enforcing

# Boot loader configuration
bootloader --location=mbr --driveorder=sda --append="console=tty0 console=ttyS0,115200n8"

# Disk partitioning
zerombr
clearpart --all --initlabel --drives=sda
autopart --type=lvm

# Package selection
%packages --ignoremissing --excludedocs
@core
@base
openssh-server
vim-minimal
wget
curl
-plymouth*
-fprintd-pam
-intltool
%end

# Post-installation script
%post --log=/var/log/ks-post.log
# Enable SSH service
systemctl enable sshd

# Configure SSH to allow root login (for lab purposes)
sed -i 's/#PermitRootLogin yes/PermitRootLogin yes/' /etc/ssh/sshd_config

# Create a simple welcome message
echo "AlmaLinux VM ready - Nested Virtualization Lab" > /etc/motd
echo "Root password: alma123!" >> /etc/motd
echo "SSH enabled on all interfaces" >> /etc/motd

# Log completion
echo "Kickstart post-installation completed at $(date)" >> /var/log/ks-post.log
%end

# Reboot after installation
reboot

